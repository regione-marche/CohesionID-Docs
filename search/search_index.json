{"config":{"lang":["it"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Cohesion id","text":""},{"location":"#che-cose","title":"Che cos'\u00e8?","text":"<p>CohesionID \u00e8 il framework di autenticazione della Regione Marche che permette di verificare la corretta identit\u00e0 degli utenti (Persone fisiche munite di codice fiscale) che accedono a servizi digitali della Regione o degli Enti convenzionati. </p> <p>Cohesion gestisce il processo di autenticazione mentre demanda al sistema integrante il processo di autorizzazione/profilatura utente all\u2019applicazione chiamante. Cohesion supporta diversi livelli di autenticazione sicura: basso, significativo ed elevato. </p>"},{"location":"#con-quali-modalita-e-possibile-accedere-con-cohesion","title":"Con quali modalit\u00e0 \u00e8 possibile accedere con Cohesion?","text":"<p>Cohesion supporta tutti i principali sistemi di autenticazione e di identificazione digitale verso i sistemi della PA, previsti dal Codice dell\u2019Amministrazione Digitale (decreto legislativo 7 marzo 2005, n. 82). I cittadini possono accedere tramite le loro credenziali SPID, con la loro Carta di Identit\u00e0 Elettronica (CIE-ID), Tramite CNS e tramite il nodo italiano eIDAS. Ulteriori informazioni circa le due modalit\u00e0 di accesso principali sono reperibili all\u2019indirizzo: Cohesion</p>"},{"location":"#accedere-con-spid","title":"Accedere con SPID","text":"<p>Il Sistema Pubblico di Identit\u00e0 Digitale (SPID) \u00e8 un\u2019identit\u00e0 digitale composta da una coppia di credenziali (username e password), strettamente personali, con le quali \u00e8 possibile accedere ai servizi online della pubblica amministrazione e dei privati aderenti.  Per ottenere le tue credenziali SPID puoi rivolgerti a uno dei gestori di identit\u00e0 (detti identity provider) accreditati dall\u2019Agenzia per l\u2019Italia Digitale (AgID). Al momento i gestori d\u2019identit\u00e0 sono 12: Aruba PEC SpA, Etna Hitech SCpA, InfoCamere SCpA, InfoCert SpA, Intesi Group SpA, Lepida ScpA, Namirial SpA, Poste Italiane SpA, Register SpA, Sielte SpA, TeamSystem SpA e TI Trust Technologies Srl.  Ogni gestore offre diverse modalit\u00e0 per richiedere e ottenere SPID: scegli quella pi\u00f9 adatta alle tue esigenze. Per tutte le informazioni su dove e come chiedere le tue credenziali SPID vai alla pagina Come attivare SPID.</p>"},{"location":"#accedere-con-cie","title":"Accedere con CIE","text":"<p>La Carta di Identit\u00e0 Elettronica (CIE) \u00e8 la chiave di accesso, garantita dallo Stato e rilasciata dal Ministero dell\u2019Interno, che permette al cittadino di autenticarsi in tutta sicurezza ai servizi online di enti e pubbliche amministrazioni che ne consentono l\u2019utilizzo.</p> <p>Grazie alla CIE i cittadini non devono pi\u00f9 utilizzare credenziali diverse per ogni Amministrazione, ma hanno a disposizione un unico strumento di identificazione fisica e digitale per accedere ai servizi in rete, pubblici e privati, in Italia e in Europa.</p> <p>Infatti, con la realizzazione del nodo eIDAS italiano si completa il progetto di cittadinanza digitale europea, che permette ai titolari di una CIE di accedere anche ai servizi online di altri Paesi dell\u2019Unione Europea (ad esempio servizi universitari, bancari o delle pubbliche amministrazioni). Per informazioni sul come ottenere ed attivare la tua CIE, consulta la pagina CIE: La Carta di Identit\u00e0 Digitale</p>"},{"location":"#accedere-con-cns","title":"Accedere con CNS","text":"<p>La Carta Nazionale dei Servizi (CNS) \u00e8 uno strumento di identificazione in rete che consente la fruizione dei servizi delle amministrazioni pubbliche. La CNS non contiene la foto del titolare e non richiede particolari requisiti di sicurezza per il supporto plastico. La completa corrispondenza informatica tra CNS e Carta d'Identit\u00e0 Elettronica (CIE) assicura l\u2019interoperabilit\u00e0 tra le due carte. Per maggiori informazioni circa le modalit\u00e0 di accesso con CNS \u00e8 possibile consultare il sito CNS: Carta Nazionale dei Servizi</p>"},{"location":"Documentazione-tecnica/","title":"Integrazione Classe C#","text":""},{"location":"Documentazione-tecnica/#integrazione-classe-c-core","title":"Integrazione Classe C# Core","text":""},{"location":"Documentazione-tecnica/#integrazione-servlet-java","title":"Integrazione Servlet Java","text":""},{"location":"Documentazione-tecnica/#integrazione-php","title":"Integrazione PHP","text":""},{"location":"Documentazione-tecnica/#integrazione-phyton-beta","title":"Integrazione Phyton (beta)","text":""},{"location":"FAQ/","title":"FAQ (Frequently Asked Questions)","text":""},{"location":"FAQ/#che-cose-cohesion-id","title":"Che cos'\u00e8 Cohesion ID?","text":"<p>Cohesion ID \u00e8 un framework di autenticazione progettato per verificare l'identit\u00e0 degli utenti (persone fisiche con codice fiscale) che accedono ai servizi digitali della Regione Marche o degli Enti convenzionati.</p>"},{"location":"FAQ/#quali-sono-i-livelli-di-autenticazione-supportati-da-cohesion","title":"Quali sono i livelli di autenticazione supportati da Cohesion?","text":"<p>Cohesion supporta tre livelli di autenticazione: basso, significativo ed elevato, offrendo opzioni di sicurezza adatte a diverse esigenze.</p>"},{"location":"FAQ/#quali-sono-i-sistemi-di-autenticazione-supportati-da-cohesion","title":"Quali sono i sistemi di autenticazione supportati da Cohesion?","text":"<p>Cohesion supporta i principali sistemi di autenticazione e identificazione digitale previsti dal Codice dell'Amministrazione Digitale, tra cui SPID, Carta di Identit\u00e0 Elettronica (CIE-ID), CNS e nodo italiano eIDAS.</p>"},{"location":"FAQ/#come-posso-ottenere-credenziali-di-accesso-a-cohesion-se-sono-dipendente-o-collaboratore-della-pubblica-amministrazione","title":"Come posso ottenere credenziali di accesso a Cohesion se sono dipendente o collaboratore della pubblica amministrazione?","text":"<p>I dipendenti e collaboratori della pubblica amministrazione possono ottenere credenziali specifiche contattando l'helpdesk di Cohesion all'indirizzo helpdeskcohesion@regione.marche.it. Le credenziali vengono rilasciate su indicazione del dirigente di appartenenza.</p>"},{"location":"FAQ/#ho-bisogno-di-assistenza-per-lintegrazione-di-cohesion-nel-mio-applicativo-chi-posso-contattare","title":"Ho bisogno di assistenza per l'integrazione di Cohesion nel mio applicativo, chi posso contattare?","text":"<p>Se hai bisogno di aiuto in merito all'integrazione di Cohesion, contattaci all'indirizzo Integrazione Cohesion</p>"},{"location":"FAQ/#come-posso-ottenere-il-mio-id-sito","title":"Come posso ottenere il mio ID Sito?","text":"<p>Se il sistema informativo che vuoi integrare \u00e8 pubblicato da o per conto di Regione Marche, \u00e8 possibile compilare direttamente la richiesta di integrazione al seguente link: https://procedimenti.regione.marche.it/Pratiche/Avvia/3049</p> <p>Effettuata la richiesta, i nostri tecnici forniranno il vostro codice ID Sito univoco.</p> <p>Nel caso in cui l'ente responsabile sia differente, \u00e8 necessario assicurarsi che questi abbia sottoscritto la convenzione per l'utilizzo dell'Infrastruttura di autenticazione e accesso della Regione Marche in qualit\u00e0 di soggetto aggregatore SPID:  https://procedimenti.regione.marche.it/AreaPA/TipologieProcedimento/DettagliTer/13915</p>"},{"location":"Flusso-di-Autenticazione/","title":"Flusso di Autenticazione","text":""},{"location":"Flusso-di-Autenticazione/#1-lutente-richiede-di-effettuare-il-login","title":"1. L'utente richiede di effettuare il login","text":"<p>L'utente desidera effettuare l'accesso ad un'applicazione che integra il sistema Cohesion, cliccando sul login viene reindirizzato al sistema Cohesion ID.</p>"},{"location":"Flusso-di-Autenticazione/#2-lutente-sceglie-lidp","title":"2. L'utente sceglie l'IdP","text":"<p>L'utente seleziona l'Identity Provider per effettuare la procedura di riconoscimento.  Cohesion genera una richiesta di accesso in cui ottiene il Codice Fiscale e l'ID Sessione dell'utente.</p>"},{"location":"Flusso-di-Autenticazione/#3-accesso-allapplicativo","title":"3. Accesso all'applicativo","text":"<p>Cohesion effettua una seconda chiamata al fine ottenere gli attributi dell'utente recuperati dall'Identity Provider scelto dall'utente.</p> <p>L'utente viene reindirizzato all'applicazione con un token proprietario, contente gli attributi necessari all'accesso.</p>"},{"location":"Flusso-di-Autenticazione/#auth-request","title":"Auth Request","text":"<p>Per accedere ai servizi offerti da CohesionID, \u00e8 necessario effettuare una chiamata in GET all'indirizzo https://cohesion2.regione.marche.it/SPManager/WAYF.aspx con un parametro AUTH contenente dei parametri di autenticazione come quelli dell'esempio in basso.</p> <p>Il chiamante, in questo esempio, sar\u00e0 example.cohesion.it:</p> <pre><code>&lt;?xml version=\"1.0\" ?&gt;\n&lt;dsAuth xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://tempuri.org/Auth.xsd\"&gt;\n    &lt;auth&gt;\n        &lt;user/&gt;\n        &lt;id_sa/&gt;\n        &lt;id_sito&gt;ID SITO ASSEGNATO&lt;/id_sito&gt;\n        &lt;esito_auth_sa/&gt;\n        &lt;id_sessione_sa/&gt;\n        &lt;id_sessione_aspnet_sa/&gt;\n        &lt;url_validate&gt;https://example.cohesion.it/cohesionAuthCallback&lt;/url_validate&gt;\n        &lt;url_richiesta&gt;https://example.cohesion.it:443/cohesionErrorCallback&lt;/url_richiesta&gt;\n        &lt;esito_auth_sso/&gt;\n        &lt;id_sessione_sso/&gt;\n        &lt;id_sessione_aspnet_sso/&gt;\n        &lt;stilesheet&gt;AuthRestriction=1,2,3&lt;/stilesheet&gt;\n    &lt;/auth&gt;\n&lt;/dsAuth&gt;\n</code></pre> <p>In particolare:</p> <ul> <li>id_sito: \u00e8 l'identificativo assegnato all'integrazione specifica con Cohesion. Ogni sito ha un id_sito differente e univoco</li> <li>url_validate: contiente l'URL al quale Cohesion reindirizza i dati ottenuti dall'Identity Provider utilizzato (Poste, Namirial, Cohesion, ecc...) dopo la login</li> <li>url_richieste: contiene l'URL della pagina a cui tornare in caso di errori di autenticazione</li> <li>stilesheet: contiente (opzionalmente) l'URL al quale Cohesion fa il redirect dopo aver eseguito la cancellazione della sessione in seguito ad una richiesta di logout. Contiene anche eventuali restrizioni sul livello di autenticazione richiesto (SPID livello 1, 2 o 3). Per specificare il livello di autenticazione \u00e8 sufficiente inserire il parametro <code>&lt;AuthRestriction=1,2,3&gt;</code> indicando il numero del livello minimo accettabile (per accettare ogni tipo di autenticazione, impostare il parametro con 0,1,2,3)</li> </ul> <p>Esempio:</p> <pre><code>&lt;?xml version=\"1.0\" ?&gt;\n&lt;dsAuth xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://tempuri.org/Auth.xsd\"&gt;\n    &lt;auth&gt;\n        &lt;user/&gt;\n        &lt;id_sa/&gt;\n        &lt;id_sito&gt;COHESION_EXAMPLE&lt;/id_sito&gt;\n        &lt;esito_auth_sa/&gt;\n        &lt;id_sessione_sa/&gt;\n        &lt;id_sessione_aspnet_sa/&gt;\n        &lt;url_validate&gt;https://example.cohesion.it/Login&lt;/url_validate&gt;\n        &lt;url_richiesta&gt;https://example.cohesion.it&lt;/url_richiesta&gt;\n        &lt;esito_auth_sso/&gt;\n        &lt;id_sessione_sso/&gt;\n        &lt;id_sessione_aspnet_sso/&gt;\n        &lt;stilesheet&gt;AuthRestriction=2,3;https://example.cohesion.it/LogOff&lt;/stilesheet&gt;\n    &lt;/auth&gt;\n&lt;/dsAuth&gt;\n</code></pre> <p>In questo esempio, diciamo a Cohesion che:</p> <ul> <li>vogliamo che il token di autenticazione venga inoltrato in POST (per default) all'indirizzo https://example.cohesion.it/Login</li> <li>vogliamo che, una volta fatto il logout, Cohesion reindirizzi all'URL https://example.cohesion.it/LogOff</li> <li>il livello di autenticazione minimo accettabile \u00e8 il 2 (Codice fiscale + password + PIN se l'IdP \u00e8 Cohesion oppure SPID livello 2 negli altri casi).</li> <li>se ci sono errori, vogliamo che Cohesion torni alla homepage https://example.cohesion.it</li> </ul> <p>L'XML contenuto nel parametro auth deve essere codificato in base64 e poi con URL Encode. Un esempio di prodotto finale ha questa forma:</p> <pre><code>PD94bWwgdmVyc2lvbj0iMS4wIiA%2FPg0KPGRzQXV0aCB4bWxuczp4c2k9Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvWE1MU2NoZW1hLWluc3RhbmNlIi\nB4bWxucz0iaHR0cDovL3RlbXB1cmkub3JnL0F1dGgueHNkIj4NCgk8YXV0aD4NCgkJPHVzZXIvPg0KCQk8aWRfc2EvPg0KCQk8aWRfc2l0bz5leGFtcGxl\nPC9pZF9zaXRvPg0KCQk8ZXNpdG9fYXV0aF9zYS8+DQoJCTxpZF9zZXNzaW9uZV9zYS8+DQoJCTxpZF9zZXNzaW9uZV9hc3BuZXRfc2EvPg0KCQk8dXJsX3Z\nhbGlkYXRlPmh0dHBzOi8vZXhhbXBsZS5jb2hlc2lvbi5pdC9Mb2dpbjwvdXJsX3ZhbGlkYXRlPg0KCQk8dXJsX3JpY2hpZXN0YT5odHRwczovL2V4YW1wb\nGUuY29oZXNpb24uaXQ8L3VybF9yaWNoaWVzdGE+DQoJCTxlc2l0b19hdXRoX3Nzby8+DQoJCTxpZF9zZXNzaW9uZV9zc28vPg0KCQk8aWRfc2Vzc2lvbm\nVfYXNwbmV0X3Nzby8+DQoJCTxzdGlsZXNoZWV0PkF1dGhSZXN0cmljdGlvbj0yLDM7aHR0cHM6Ly9leGFtcGxlLmNvaGVzaW9uLml0L0xvZ09mZjwvc3Rpb\nGVzaGVldD4NCgk8L2F1dGg+DQo8L2RzQXV0aD4\n</code></pre>"},{"location":"Flusso-di-Autenticazione/#cosa-contiene-il-token-cohesion-dopo-lautenticazione","title":"Cosa contiene il token Cohesion dopo l'autenticazione?","text":"<p>Dopo l'autenticazione dell'utente, Cohesion effettua una chiamata POST all'indirizzo specificato in url_validate nel cui body verr\u00e0 specificato un token di autenticazione.  Nel body ci sar\u00e0 un elemento auth codificato in base64 e URL Encoded che conterr\u00e0 un XML di questo tipo:</p> <pre><code>&lt;?xml version=\"1.0\" ?&gt;\n&lt;dsAuth xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://tempuri.org/Auth.xsd\"&gt;\n    &lt;auth&gt;\n        &lt;user&gt;RSSMRA85D18F051Y&lt;/user&gt;\n        &lt;id_sa/&gt;\n        &lt;id_sito&gt;example&lt;/id_sito&gt;\n        &lt;esito_auth_sa/&gt;\n        &lt;id_sessione_sa/&gt;\n        &lt;id_sessione_aspnet_sa/&gt;\n        &lt;url_validate&gt;https://example.cohesion.it/Login&lt;/url_validate&gt;\n        &lt;url_richiesta&gt;https://example.cohesion.it&lt;/url_richiesta&gt;\n        &lt;esito_auth_sso&gt;OK&lt;/esito_auth_sso&gt;\n        &lt;id_sessione_sso&gt;A5D64899EBCEE1FA6B3E8FB3D3D358D7E5843EA25EDFD62277CACE8A5EF23B1C5E6FAB916F333B0AFB0FAE6C4CDF7B8E8DEE461E8661DB04F5FFB01BC0EF9FCB90EEA2ACA7988119EFE17D5C3BB58BC890D75D724D434D7D60C2F451F6A51D1DFFA900EF0AAA631A51458860C6CEC7B1EBC525561624208066DF276314F41F6EC258CA3F&lt;/id_sessione_sso&gt;\n        &lt;id_sessione_aspnet_sso&gt;ufrq00x4f0cq2yog2ozv4lxx;https://idp.namirialtsp.com/idp;https://example.cohesion.it/LogOff;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;&lt;/id_sessione_aspnet_sso&gt;\n        &lt;stilesheet&gt;AuthRestriction=1,2,3;https://example.cohesion.it/LogOff&lt;/stilesheet&gt;\n        &lt;ip xmlns=\"\"&gt;cohesion2.regione.marche.it&lt;/ip&gt;\n        &lt;AuthRestriction xmlns=\"\"&gt;1,2,3&lt;/AuthRestriction&gt;\n        &lt;UType xmlns=\"\"&gt;CD&lt;/UType&gt;\n        &lt;purpose xmlns=\"\"/&gt;\n        &lt;url_logout xmlns=\"\"&gt;https://example.cohesion.it/LogOff&lt;/url_logout&gt;\n        &lt;cittad xmlns=\"\"&gt;1&lt;/cittad&gt;\n    &lt;/auth&gt;\n&lt;/dsAuth&gt;\n</code></pre> <p>Queste informazioni contengono solamente il codice fiscale dell'utente, ma non i suoi attributi. Per ottenere gli attributi completi, \u00e8 necessario effettuare una chiamata GET o POST all'indirizzo https://cohesion2.regione.marche.it/SPManager/webCheckSessionSSO.aspx con i seguenti parametri:</p> <pre><code>Operation=GetCredential&amp;IdSessioneSSO={id_sessione_sso}&amp;IdSessioneASPNET={id_sessione_aspnet_sso}\n</code></pre> <p>Il token SAML restituito da Cohesion avr\u00e0 la forma seguente:</p> <pre><code>&lt;Signature xmlns=\"http://www.w3.org/2000/09/xmldsig#\"&gt;\n    &lt;SignedInfo&gt;\n        &lt;CanonicalizationMethod Algorithm=\"http://www.w3.org/TR/2001/REC-xml-c14n-20010315\"/&gt;\n        &lt;SignatureMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#rsa-sha1\"/&gt;\n        &lt;Reference URI=\"#SignedXmlId\"&gt;\n            &lt;DigestMethod Algorithm=\"http://www.w3.org/2000/09/xmldsig#sha1\"/&gt;\n            &lt;DigestValue&gt;rNHSy/TcTBIweMerIO3jizVm7u0=&lt;/DigestValue&gt;\n        &lt;/Reference&gt;\n    &lt;/SignedInfo&gt;\n    &lt;SignatureValue&gt;\n        Oz9wACp9Rxo4Z4pC8o61iXuVSJNO+UcszPNcAMNFUAY0I17IeGnB93JpwEWGbPfqn5a+i3IQdNsqlIbQtwAGovBQ6DTTb85kDo4YDue26o7a4np5DfwnO6SuhHsBHMbTvnI9A+45Q7Li4On+eELEQWFRrbS11MmwRYBxR5m5PWKupkX3O2r9JtG6tuKwi/L5+A4U/MqLKDdUm9/TX1lzn5c23XpQgiYpkGrwRqp+Q1Dsem7FcV868VYvgwYkRkj/jNgLFtcdoFij+qBRZi47EUa35KeZgP5V1ENcYigG0OXQQbdavCnPcE3EHjEL3ApkuPNVuSbJZv5TjgFdCpqjXg==\n    &lt;/SignatureValue&gt;\n    &lt;KeyInfo&gt;\n        &lt;X509Data&gt;\n            &lt;X509Certificate&gt;\n                MIIGtDCCBJygAwIBAgITLAAAAIIFAntkot9CUgAAAAAAgjANBgkqhkiG9w0BAQsFADBXMRUwEwYKCZImiZPyLGQBGRYFaW50cmExHTAbBgoJkiaJk/IsZAEZFg1yZWdpb25lbWFyY2hlMR8wHQYDVQQDExZSZWdpb25lIE1hcmNoZSBTdWJDQTAxMB4XDTE4MDIxOTA5MjgwM1oXDTIyMDIxODA5MjgwM1owgcIxCzAJBgNVBAYTAklUMQ4wDAYDVQQIEwVJdGFseTEPMA0GA1UEBxMGQW5jb25hMRcwFQYDVQQKEw5SZWdpb25lIE1hcmNoZTEtMCsGA1UECxMkUC5GLiBJbmZvcm1hdGljYSBlIENyZXNjaXRhIERpZ2l0YWxlMRcwFQYDVQQDEw5DbGllbnRDb2hlc2lvbjExMC8GCSqGSIb3DQEJARYiaGVscGRlc2tDb2hlc2lvbkByZWdpb25lLm1hcmNoZS5pdDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALbvK/Y/2uiFLqJoBmLHyKB7a3EnfqJJ+ySQEA9K1V+PEaRacctKmTDKRF5BHuIs1mCJDGcyz79kFyu+FyQL6LwL4PZ1PB+SsSVtnh+jCjO+4a/VYoC2t1/KJ7wlYQ0Wh22RVVfcqgaweyfaswBbdO+PyMPJ13LqMx6sC3m2oJkIzEvTSZRkxGPJAaduyIHjjjmZgXLFxnQqUBHrOANYoPJLyxJtN1UrEAjcZL3okCs3I4zv2hknmiV6gqFNPYVptU6b1k8MJPbiUpwxxfZt+ZInyad8egb9V3FLp6M5PU7QEVDHec2PUFONjHSe04yDwv1dYjwTdJx7ZzUzvHHYuBECAwEAAaOCAgswggIHMAsGA1UdDwQEAwIFoDA8BgkrBgEEAYI3FQcELzAtBiUrBgEEAYI3FQiHv+4hg+DuDYfFhR6H2P57woNRTYSKtleCuuwpAgFkAgEVMB0GA1UdDgQWBBQMQ+vWVxhmUh5WEF974KQX3J2JKTAfBgNVHSMEGDAWgBQ1CQik+pfAKExgnMYzrKUCwbrhyzCBmAYDVR0fBIGQMIGNMIGKoIGHoIGEhkBodHRwOi8vcGtpMS5yZWdpb25lLm1hcmNoZS5pdC9jcmwvUmVnaW9uZSUyME1hcmNoZSUyMFN1YkNBMDEuY3JshkBodHRwOi8vcGtpMi5yZWdpb25lLm1hcmNoZS5pdC9jcmwvUmVnaW9uZSUyME1hcmNoZSUyMFN1YkNBMDEuY3JsMIGsBggrBgEFBQcBAQSBnzCBnDBMBggrBgEFBQcwAoZAaHR0cDovL3BraTEucmVnaW9uZS5tYXJjaGUuaXQvYWlhL1JlZ2lvbmUlMjBNYXJjaGUlMjBTdWJDQTAxLmNydDBMBggrBgEFBQcwAoZAaHR0cDovL3BraTIucmVnaW9uZS5tYXJjaGUuaXQvYWlhL1JlZ2lvbmUlMjBNYXJjaGUlMjBTdWJDQTAxLmNydDATBgNVHSUEDDAKBggrBgEFBQcDATAbBgkrBgEEAYI3FQoEDjAMMAoGCCsGAQUFBwMBMA0GCSqGSIb3DQEBCwUAA4ICAQAd15k3Qub5SVaNRr2CfX7MOQnavfienMWejpDn0IORfdk1pDf/+sc8Kd/5N1qaVKY3emCgVpx1lakrbTCHKEiJWzlKQ3nqzTrsP4NVAegybE7srps00KV6IkhurwXf+AV1lCnIm2/0KtCZC8V302CR9vwCk1EVJZQLSGIx4EZGhOhN8dy3GQw/KYBJZs60F2ilXH3VDBS60gmnd0rnfcnZ9QbA3scQzL4ZZImV356sHXGkaL1rsuCq1cOxecVoZ1h0Ase2oieUCCBAffLTtQhcvowYfjJG36LEyIXtLZqed0i+C8ESumxZmgsOrNIRxem36Dt2u1CAX+oD8M/4+tzzVkDHy2WxY4S7VHVKXvYC8NkQMlD3NkurduLQ6r1RkoLgQBeLAXOFMV3J7nw8fnP8vQ4nHgposzlEefcOJl1iIhn8CQKAqHDUIRqYRMfM/vRgkK18iyYkUo2T0bzji1CSHXnTn9k9BCFKJLc7iv7p8isslOoqnFdkHZI4LTVENTYhklwlA1E/0baevMv6rwtJp5zFoWOZUCvfshdUt90apYY2NmWBPJyE5x7plqMPIzwtccPWc4/Az9tmBRHewi8a3YEE99R6W/w8vfM4TKAbkHBkpS1ue6WAWfzEQEqfdkSN57c5pk54unkvYnMum5sS4juuReRb5aKqgmvh4GzO8A==\n            &lt;/X509Certificate&gt;\n        &lt;/X509Data&gt;\n    &lt;/KeyInfo&gt;\n    &lt;Object Id=\"SignedXmlId\"&gt;\n        &lt;profile timestamp=\"Tue, 25 Jan 2022 22:02:49 GMT\" xmlns=\"\"&gt;\n            &lt;base&gt;\n                &lt;placeOfBirth&gt;F051&lt;/placeOfBirth&gt;\n                &lt;localita_nascita&gt;ROMA&lt;/localita_nascita&gt;\n                &lt;address&gt;Via dei matti 28 60044 ANCONA AN&lt;/address&gt;\n                &lt;indirizzo_residenza&gt;Via dei matti 28 60044 ANCONA AN&lt;/indirizzo_residenza&gt;\n                &lt;gender&gt;M&lt;/gender&gt;\n                &lt;sesso&gt;M&lt;/sesso&gt;\n                &lt;digitalAddress&gt;xxxxxxxxxxx@pec.it&lt;/digitalAddress&gt;\n                &lt;email_certificata&gt;xxxxxxxxxxx@pec.it&lt;/email_certificata&gt;\n                &lt;familyName&gt;ROSSI&lt;/familyName&gt;\n                &lt;cognome&gt;ROSSI&lt;/cognome&gt;\n                &lt;name&gt;MARIO&lt;/name&gt;\n                &lt;nome&gt;MARIO&lt;/nome&gt;\n                &lt;dateOfBirth&gt;1985-04-18&lt;/dateOfBirth&gt;\n                &lt;data_nascita&gt;18/04/1985&lt;/data_nascita&gt;\n                &lt;spidCode&gt;NAMI0002653481&lt;/spidCode&gt;\n                &lt;countyOfBirth&gt;RM&lt;/countyOfBirth&gt;\n                &lt;provincia_nascita&gt;RM/provincia_nascita&gt;\n                &lt;fiscalNumber&gt;TINIT-RSSMRA85D18F051Y&lt;/fiscalNumber&gt;\n                &lt;codice_fiscale&gt;RSSMRA85D18F051Y&lt;/codice_fiscale&gt;\n                &lt;email&gt;mario.rossi@regione.marche.it&lt;/email&gt;\n                &lt;companyFiscalNumber/&gt;\n                &lt;tipo_autenticazione&gt;PIN&lt;/tipo_autenticazione&gt;\n                &lt;login&gt;RSSMRA85D18F051Y&lt;/login&gt;\n                &lt;samlResponseBase64&gt;PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgi...&lt;/samlResponseBase64&gt;\n            &lt;/base&gt;\n        &lt;/profile&gt;\n    &lt;/Object&gt;\n</code></pre> <p>Gli attributi dell'utente sono contenuti nell'oggetto Object. Gli attributi restituiti possono variare in base all'Identity Provider, al livello di autenticazione e dalle impostazioni dell'utente.</p> <p>NOTA BENE: Object contiene anche il token SAML in <code>samlResponseBase64</code> il cui valore \u00e8 quello della SAMLResponse originale restituita dall'Identity Provider scelto dall'utente.</p>"},{"location":"Flusso-di-Autenticazione/#come-effettuare-il-logout","title":"Come effettuare il logout?","text":"<p>Per effettuare il logout baster\u00e0 semplicemente chiamare lo stesso endpoint utilizzato per ottenere gli attributi dell'utente andando a modificare il parametro Operation e specificando LogoutSito invece di GetCredential</p> <p>Nel nostro esempio</p> <pre><code>https://cohesion2.regione.marche.it/SPManager/webCheckSessionSSO.aspx?Operation=LogoutSito&amp;IdSessioneSSO=A5D64899EBCEE1FA6B3E8FB3D3D358D7E5843EA25EDFD62277CACE8A5EF23B1C5E6FAB916F333B0AFB0FAE6C4CDF7B8E8DEE461E8661DB04F5FFB01BC0EF9FCB90EEA2ACA7988119EFE17D5C3BB58BC890D75D724D434D7D60C2F451F6A51D1DFFA900EF0AAA631A51458860C6CEC7B1EBC525561624208066DF276314F41F6EC258CA3F&amp;IdSessioneASPNET=ufrq00x4f0cq2yog2ozv4lxx;https://idp.namirialtsp.com/idp;https://q-marche.turitweb.it/LogOff;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;AAdzZWNyZXQxGLSQhZFb4TSPKKPNCGfO5MaCcJ99DiuEnIzpO4YvtOrgf+6qvwyEVOguFDCVbyPcZ2hhjbBtPtuCWUGs+FYX9zREfvZ1heshK7yzE24MU7JsIBK17atMdbL31QbDPNKbH2wiswXhL2CJGjY=;\n</code></pre>"},{"location":"Integrazione-.NET-Core-8/","title":"Integrazione .NET Core 8","text":""},{"location":"Integrazione-.NET-Core-8/#cohesion2netcore","title":"Cohesion2NETCore","text":"<p>Adattamento della classe CohesionSSO.cs per l'utilizzo con .NET Core.</p>"},{"location":"Integrazione-.NET-Core-8/#per-integrare-cohesion","title":"Per integrare Cohesion","text":"<p>Per integrare l'autenticazione in Cohesion nel proprio sito \u00e8 sufficiente aggiungere la classe C# CohesionSSO.cs al proprio progetto .NET Core e richiamare i metodi <code>ValidateFE</code> e <code>LogoutFE</code>. I metodi vanno richiamati dopo aver inizializzato la classe mediante il costruttore disponibile ed utilizzando la programmazione asincrona tramite i costrutti <code>async</code> e <code>await</code>.</p> <p>Una volta autenticati, il token di autenticazione verr\u00e0 automaticamente salvato nella variabile di sessione <code>token</code>, che conterr\u00e0 l'XML con le informazioni specifiche dell'utente.</p> <p>La classe utilizza la cookie authentication: nel cookie viene automaticamente registrato il codice fiscale dell'utente (nodo <code>&lt;login&gt;</code> del token).</p> <p>Il costruttore della classe prevede i seguenti parametri, eventualmente definibili nel file <code>appsettings.json</code> del progetto:</p> <ul> <li><code>HttpContext</code>: contesto HTTP dal quale vengono automaticamente estrapolate le informazioni relative alla richiesta, alla risposta e alla sessione</li> <li><code>SSOCheckURL</code>: parametro fisso della pagina SSO di Cohesion</li> <li><code>SSOWebCheckSessionURL</code>: parametro fisso della pagina di recupero token di autenticazione</li> <li><code>SuccessURL</code>: URL a cui si viene reindirizzati se l'autenticazione \u00e8 andata a buon fine</li> <li><code>ErrorURL</code>: URL a cui si viene reindirizzati in caso di errore di autenticazione</li> <li><code>SSOAdditionalData</code>: parametri opzionali di autenticazione</li> <li><code>IdSito</code>: fornito dalla Regione Marche al momento dell'abilitazione a Cohesion</li> </ul> <p>Di seguito un esempio di codice (pattern MVC) in cui i metodi vengono richiamati all'interno delle action <code>Login</code> e <code>Logout</code> di un controller <code>AccountController</code>:</p> <pre><code>public class AccountController : Controller\n{\n    private readonly IHttpContextAccessor _httpContextAccessor;\n    private readonly CohesionSettingsOptions _cohesionOptions;\n\n    public AccountController(IHttpContextAccessor httpContextAccessor, IOptions&lt;CohesionSettingsOptions&gt; cohesionOptions)\n    {\n        _httpContextAccessor = httpContextAccessor;\n        _cohesionOptions = cohesionOptions.Value;\n    }\n\n    public async Task Login()\n    {\n        var httpContext = _httpContextAccessor.HttpContext;\n\n        if (httpContext == null)\n        {\n            return;\n        }\n\n        var request = httpContext.Request;\n        var response = httpContext.Response;\n        var session = httpContext.Session;\n\n        if (request == null || response == null || session == null)\n        {\n            return;\n        }\n\n        var cohesionSSO = new CohesionSSO(httpContext, _cohesionOptions.SSOCheckURL, _cohesionOptions.SSOWebCheckSessionURL, _cohesionOptions.SuccessURL, _cohesionOptions.ErrorURL, _cohesionOptions.SSOAdditionalData, _cohesionOptions.IdSito);\n        await cohesionSSO.ValidateFE();\n    }\n\n    public async Task Logout()\n    {\n        var httpContext = _httpContextAccessor.HttpContext;\n\n        if (httpContext == null)\n        {\n            return;\n        }\n\n        var request = httpContext.Request;\n        var response = httpContext.Response;\n        var session = httpContext.Session;\n\n        if (request == null || response == null || session == null)\n        {\n            return;\n        }\n\n        var cohesionSSO = new CohesionSSO(httpContext, _cohesionOptions.SSOCheckURL, _cohesionOptions.SSOWebCheckSessionURL, _cohesionOptions.SuccessURL, _cohesionOptions.ErrorURL, _cohesionOptions.SSOAdditionalData, _cohesionOptions.IdSito);\n        await cohesionSSO.LogoutFE();\n    }\n}\n</code></pre> <p>Per ulteriori dettagli, fare riferimento al codice della classe e alla documentazione ufficiale disponibile nela sezione Integrazione Classe C#.</p>"},{"location":"Integrazione-C-Sharp-Core/","title":"Integrazione C# Core","text":"<p>Con il presente si vuole fornire una panoramica completa delle modalit\u00e0 di integrazione e delle configurazioni di utilizzo del Service Provider fornito con Cohesion in applicativi web che richiedono autenticazione e profilazione utente. Verr\u00e0 in dettaglio descritta la procedura di installazione in ambiente IIS mediante classe C# CohesionSSO.cs e la configurazione per l\u2019utilizzo classico ed il funzionamento in modalit\u00e0 federata SAML2.0. Questa modalit\u00e0 \u00e8 sempre preferibile e in particolare \u00e8 necessaria qualora non venga rilasciato all\u2019ente un certificato personale per la comunicazione con Cohesion.</p>"},{"location":"Integrazione-C-Sharp-Core/#come-integrarlo-nel-proprio-applicativo","title":"Come integrarlo nel proprio applicativo","text":"<p>Demo asp net core</p> <p>In questa pagina \u00e8 presente un'applicativo di test di autenticazione Cohesion su asp net core in modo da poter provare le funzionalit\u00e0. Nella repo della demo sono indicati i requisiti ed i passaggi da eseguire per integrare l'autenticazione cohesion nel proprio applicativo vengono indicati i requisiti e come fare per integrare Cohesion.</p>"},{"location":"Integrazione-C-Sharp-Core/#cohesionservicecs","title":"CohesionService.cs","text":"<p>Questo service mette a disposizione una serie di metodi che permettono di gestire tutti i passaggi dell'autenticazione tramite cohesion partendo dal login fino alla richiesta di logout.</p>"},{"location":"Integrazione-C-Sharp-Core/#il-metodo-requestauth","title":"Il metodo \"RequestAuth\"","text":"<p><code>RequestAuth(string urlValidation, string urlReturn)</code></p> <p>crea un base64 di una richiesta di login a cohesion dove sono richiesti 2 parametri:</p> <ul> <li>urlValidation - ovvero l'url del metodo che andr\u00e0 a gestire la validazione della richiesta di login</li> <li>urlReturn - ovvero l'url dove si vorr\u00e0 reindirizzare l'utente una volta effettuata la richiesta di login con successo</li> </ul> <p>infine ritorna un url dove verr\u00e0 rindirizzato l'utente per effettuare correttamente il login di cohesion.</p>"},{"location":"Integrazione-C-Sharp-Core/#il-metodo-checkauth","title":"Il metodo \"CheckAuth\"","text":"<p><code>CheckAuth(string auth)</code></p> <p>verifica se la richiesta di login a cohesion ha avuto esito positivo o negativo restituendo un oggetto \"AuthCohesionCheckResponse\".</p>"},{"location":"Integrazione-C-Sharp-Core/#il-metodo-logoutfe","title":"Il metodo \"LogoutFE\"","text":"<p><code>LogoutFE(_session)</code></p> <p>\u00e8 utilizzato per effettuare la richiesta logout passando al metodo la sessione attuale dell'utente dove \u00e8 possibile, se presenti, estrapolare i parametri di login ed effettuare correttamente il logout.</p>"},{"location":"Integrazione-C-Sharp-Core/#appsettingsjson","title":"appsettings.json","text":"<p>Nel file appsettings.json \u00e8 necessario impostare dei valori per il corretto funzionamento dell'autenticazione tramite cohesion.</p> <p>In particolare andranno impostate le seguenti chiavi:</p> <ul> <li>sso.check.url : parametro fisso della pagina SSO di Cohesion.</li> <li>webCheckSessionSSO : parametro fisso della pagina di recupero token di autenticazione.</li> <li>sso.additionalData : parametri opzionali di autenticazione.</li> <li>site.URLLogout : url della propria pagina di logout relativo alla posizione della pagina protetta; \u00e8 possibile specificare il parametro ReturnUrl con l'url della pagina a cui ritornare una volta effettuato il logout.</li> <li>site.id_sito: IDSito fornito da Regione Marche la momento della abilitazione alla integrazione cohesion.</li> <li>site.IndexURL: url della propria pagina a cui ritornare in caso di errore di autenticazione.</li> </ul> <p>Esempio di codice di configurazione in appsettings.json:</p> <pre><code>\"AppSettings\": {\n    \"SSOcheckUrl\": \"https://cohesion2.regione.marche.it/SPManager/WAYF.aspx\",\n    \"SSOwebCheckSession\": \"https://cohesion2.regione.marche.it/SPManager/webCheckSessionSSO.aspx\",\n    \"SSOadditionalData\": \"AuthRestriction=0,1,2,3;https://MYSITE/Account/LogOff\",\n    \"SiteIndexUrl\": \"https://MYSITE/Account/Login\",\n    \"SiteUrlLogout\": \"../Logout.aspx?ReturnUrl=https%3A%2F%2Fcohesion2.regione.marche.it%2FSPManager%2FLogout.aspx\",\n    \"SiteIdSito\": \"MYSITE\"\n  }\n</code></pre> <p>Di seguito verranno descritti i campi che \u00e8 possibile cambiare:</p> <ul> <li>site.URLLogout: Contiene l\u2019url della pagina di Logout dalla posizione della pagina autenticata. A differenza della modalit\u00e0 classica non \u00e8 per\u00f2 possibile cambiare il parametro ReturnUrl in quanto strettamente dipendente alle funzionalit\u00e0 di logout di SAML.</li> <li>site.IndexURL: se presente deve contenere l\u2019url della propria pagina a cui ritornare in caso di errore di autenticazione.</li> <li>sso.additionalData: Deve contenere obbligatoriamente il percorso completo della propria pagina di logout affinch\u00e9 il logout SAML funzioni correttamente. Pu\u00f2 contenere altri due parametri opzionali: i livelli di autenticazione da mostrare (parametro AuthRestriction) e un flag per mostrare solo i meccanismi di accesso federato SPID, CIEID, CNS e l'accesso tramite dominio. I vari parametri vanno separati da punto e virgola \";\".</li> </ul> <p>Per approfondimenti in merito alla configurazione dei parametri addizionali, \u00e8 possibile far riferimento alla pagina Parametri della Richiesta di Autenticazione</p> <p>[Opzionale]</p> <p>Prima dell'URL di logout \u00e8 possibile inserire la stringa AuthRestricion=0,1,2,3 dove i valori 0,1,2,3 indicano i livelli di autenticazione da mostrare nella pagina di login dell\u2019Idp federato selezionato, in particolare:</p> <ul> <li>0 indica di mostrare l'autenticazione SAML \"Password\"</li> <li>1 indica di mostrare l'autenticazione SAML \"Smartcard\"</li> <li>2 indica di mostrare l'autenticazione SAML \"SmartcardPKI\"</li> <li>3 indica di mostrare l'autenticazione SAML \"Kerberos\"</li> </ul> <p>I seguenti valori sono standard SAML e dovrebbero essere riconosciuti per ogni IdP federato selezionato. Nel caso venga scelto Cohesion come Idp allora i valori saranno interpretati con le modalit\u00e0 di autenticazione gi\u00e0 descritte nel punto a), a meno che non venga specificato l'altro parametro opzionale UType=c. </p> <p>E\u2019 possibile nascondere o visualizzare le modalit\u00e0 di autenticazione togliendo o aggiungendo i rispettivi valori separati da una virgola. L\u2019ordine non \u00e8 influente.</p> <p>[Opzionale]</p> <p>Dopo l'URL di logout \u00e8 possibile inserire la stringa eidas=1. L'inserimento di questa stringa abilita la login eIDAS nel sistema di autenticazione SAML 2.0 di Cohesion. Questa opzione \u00e8 compatibile con tutte le altre fin qui indicate. </p> <p>ES: AuthRestriction=2,1;http://host/YOURSITE/Logout.aspx;UType=c;eidas=1</p>"},{"location":"Integrazione-Classe-C-Sharp/","title":"Integrazione classe C#","text":"<p>Con il presente si vuole fornire una panoramica completa delle modalit\u00e0 di integrazione e delle configurazioni di utilizzo del Service Provider fornito con Cohesion in applicativi web che richiedono autenticazione e profilazione utente. Verr\u00e0 in dettaglio descritta la procedura di installazione in ambiente IIS mediante classe C# CohesionSSO.cs e la configurazione per l\u2019utilizzo classico ed il funzionamento in modalit\u00e0 federata SAML2.0. Questa modalit\u00e0 \u00e8 sempre preferibile e in particolare \u00e8 necessaria qualora non venga rilasciato all\u2019ente un certificato personale per la comunicazione con Cohesion.</p> <p>Scarica l'applicazione di test e la classe di integrazione</p> <p>Per integrare l\u2019autenticazione in Cohesion nel proprio sito \u00e8 sufficiente aggiungere la classe C# CohesionSSO.cs al proprio progetto .NET e richiamare i metodi ValidateFE e LogoutFE rispettivamente nel codice della pagina che gestisce la form authentication e della pagina di logout. I metodi vanno richiamati dopo aver inizializzato la classe mediante i costruttori disponibili. Di seguito un esempio di codice da inserire nella pagina di form authentication:</p> <p><code>CohesionSSO cohesionSSO = new CohesionSSO(Request, Response, Session);  cohesionSSO.ValidateFE();</code></p> <p>Una volta autenticati il token di autenticazione verr\u00e0 automaticamente salvato nella variabile di sessione \u201cTOKEN\u201d.</p> <p>In TestCohesion.zip \u00e8 presente un esempio di progetto .NET 2010 in cui si mostra come integrare Cohesion mediante la classe CohesionSSO.</p> <p>La classe dispone di 2 costruttori:</p> <p>Costruttore base con i soli parametri per recuperare le variabili di richiesta http, risposta http e sessione http. In questo modo tutti i parametri richiesti dovranno essere specificati nel web.config. </p> <p>In particolare andranno impostate le seguenti chiavi nel web.config:</p> <ul> <li>sso.check.url : parametro fisso della pagina SSO di Cohesion.</li> <li>webCheckSessionSSO : parametro fisso della pagina di recupero token di autenticazione.</li> <li>sso.additionalData : parametri opzionali di autenticazione.</li> <li>site.URLLogout : url della propria pagina di logout relativo alla posizione della pagina protetta; \u00e8 possibile specificare il parametro ReturnUrl con l'url della pagina a cui ritornare una volta effettuato il logout.</li> <li>site.id_sito: IDSito fornito da Regione Marche la momento della abilitazione alla integrazione cohesion.</li> <li>site.IndexURL: url della propria pagina a cui ritornare in caso di errore di autenticazione.</li> </ul> <p>Esempio di codice di configurazione in web.config:</p> <pre><code>&lt;appSettings&gt;\n &lt;add key=\"sso.check.url\" value=\"http://cohesion2.regione.marche.it/SSO/Check.aspx\"/&gt;\n &lt;add key=\"sso.webCheckSessionSSO\" value=\"https://cohesion2.regione.marche.it/SSO/webCheckSessionSSO.aspx\"/&gt;\n &lt;add key=\"sso.additionalData\" value=\"\"/&gt;\n &lt;add key=\"site.URLLogout\" value=\"../Logout.aspx?ReturnUrl=index.aspx\"/&gt;\n &lt;add key=\"site.id_sito\" value=\"MYSITE\"/&gt;\n &lt;add key=\"site.IndexURL\" value=\"index.aspx\"/&gt;\n&lt;/appSettings&gt;\n</code></pre> <p>Costruttore completo con tutti i parametri richiesti: In questo modo non si avr\u00e0 bisogno di specificare i parametri nel web.config ma si passeranno direttamente al costruttore:</p> <p><code>CohesionSSO cohesionSSO = new CohesionSSO(request, response, session, SSOCheckUrl, webCheckSessionSSOUrl, additionalData, indexUrl);</code></p> <p>Di seguito viene descritto un esempio di configurazione di questi parametri per utilizzare rispettivamente la modalit\u00e0 di funzionamento classica di Cohesion e la modalit\u00e0 di funzionamento federato mediante standard SAML2.0</p> <p>Modalit\u00e0 di funzionamento SAML2.0</p> <pre><code>&lt;appSettings&gt;\n &lt;add key=\"sso.check.url\" value=\"http://cohesion2.regione.marche.it/SPManager/WAYF.aspx\"/&gt;\n &lt;add key=\"sso.webCheckSessionSSO\" value=\"https://cohesion2.regione.marche.it/SPManager/webCheckSessionSSO.aspx\"/&gt;\n &lt;add key=\"site.URLLogout\" \n value= \"../Logout.aspx?ReturnUrl=https%3A%2F%2Fcohesion2.regione.marche.it%2FSPManager%2FLogout.aspx\"/&gt;\n &lt;add key=\"site.IndexURL\" value=\"index.aspx\"/&gt;\n &lt;add key=\"site.id_sito\" value=\"MYSITE\"/&gt;\n &lt;add key=\"sso.additionalData\" value=\"http://YOURHOST/YOURSITE/Logout.aspx\"/&gt;\n&lt;/appSettings&gt;\n</code></pre> <p>Di seguito verranno descritti i campi che \u00e8 possibile cambiare:</p> <ul> <li>site.URLLogout: Contiene l\u2019url della pagina di Logout dalla posizione della pagina autenticata. A differenza della modalit\u00e0 classica non \u00e8 per\u00f2 possibile cambiare il parametro ReturnUrl in quanto strettamente dipendente alle funzionalit\u00e0 di logout di SAML.</li> <li>site.IndexURL: se presente deve contenere l\u2019url della propria pagina a cui ritornare in caso di errore di autenticazione.</li> <li>sso.additionalData: Deve contenere obbligatoriamente il percorso completo della propria pagina di logout affinch\u00e9 il logout SAML funzioni correttamente. Pu\u00f2 contenere altri due parametri opzionali: i livelli di autenticazione da mostrare (parametro AuthRestriction) e un flag per mostrare solo i meccanismi di accesso federato SPID, CIEID, CNS e l'accesso tramite dominio. I vari parametri vanno separati da punto e virgola \";\".</li> </ul> <p>Per approfondimenti in merito alla configurazione dei parametri addizionali, \u00e8 possibile far riferimento alla pagina Parametri della Richiesta di Autenticazione</p> <p>[Opzionale]</p> <p>Prima dell'URL di logout \u00e8 possibile inserire la stringa AuthRestricion=0,1,2,3 dove i valori 0,1,2,3 indicano i livelli di autenticazione da mostrare nella pagina di login dell\u2019Idp federato selezionato, in particolare: * 0 indica di mostrare l'autenticazione SAML \"Password\" * 1 indica di mostrare l'autenticazione SAML \"Smartcard\" * 2 indica di mostrare l'autenticazione SAML \"SmartcardPKI\" * 3 indica di mostrare l'autenticazione SAML \"Kerberos\"</p> <p>I seguenti valori sono standard SAML e dovrebbero essere riconosciuti per ogni IdP federato selezionato. Nel caso venga scelto Cohesion come Idp allora i valori saranno interpretati con le modalit\u00e0 di autenticazione gi\u00e0 descritte nel punto a), a meno che non venga specificato l'altro parametro opzionale UType=c. E\u2019 possibile nascondere o visualizzare le modalit\u00e0 di autenticazione togliendo o aggiungendo i rispettivi valori separati da una virgola. L\u2019ordine non \u00e8 influente.</p> <p>[Opzionale]</p> <p>Dopo l'URL di logout \u00e8 possibile inserire la stringa eidas=1. L'inserimento di questa stringa abilita la login eIDAS nel sistema di autenticazione SAML 2.0 di Cohesion. Questa opzione \u00e8 compatibile con tutte le altre fin qui indicate.  Es. AuthRestriction=2,1;http://host/YOURSITE/Logout.aspx;UType=c;eidas=1</p>"},{"location":"Integrazione-Servlet-Java/","title":"Integrazione mediante servlet Java","text":"<p>Con il presente si vuole fornire una panoramica completa delle modalit\u00e0 di integrazione e delle configurazioni di utilizzo del Service Provider fornito con Cohesion in applicativi web che richiedono autenticazione e profilazione utente. Verr\u00e0 in dettaglio descritta la procedura di installazione in ambiente Java Servlet e la configurazione per l\u2019utilizzo classico ed il funzionamento in modalit\u00e0 federata SAML2.0.</p> <p>Scarica la Servlet Java ed il manuale</p> <p>Scarica la versione per java8 e successive</p> <p>Scarica il keystore valido a partire dal 16/02/2022</p>"},{"location":"Integrazione-Servlet-Java/#prerequisiti","title":"Prerequisiti:","text":"<ul> <li>Apache Tomcat v6+, JBoss, Glassfish</li> <li>Java v 1.6+</li> </ul> <p>La servlet per l\u2019integrazione di Cohesion \u00e8 stata riscritta in modo da essere compatibile anche con qualunque servlet container e non utilizzare librerie esterne e componenti aggiuntivi che ne potrebbero limitare la compatibilit\u00e0.</p> <p>Inoltre \u00e8 stato aggiunto il supporto alla funzionalit\u00e0 di logout, prima assente. Abbiamo quindi la servlet \u201cAuthentication\u201d che fornisce Single Sign On e la servlet \u201cLogout\u201d che effettua il logout da Cohesion. Usando questo pacchetto, Cohesion potr\u00e0 essere integrato in ogni tipologia di sito a prescindere dal linguaggio di progettazione (volendo anche in un sito .NET su IIS).</p> <p>Una volta configurata la servlet e lanciato l\u2019ambiente Tomcat infatti, sar\u00e0 sufficiente creare nel proprio sito una pagina di login che rediriga alla pagina servlet \u201cAuthentication\u201d specificando il parametro ReturnUrl, che dovr\u00e0 contenere l\u2019url della pagina a cui la servlet ritorner\u00e0 il token utente.</p> <p>Tale pagina pu\u00f2 essere la stessa pagina di login, l\u2019importante \u00e8 che sia in grado di processare il token utente ricevuto via POST. Il token \u00e8 firmato, eventualmente crittografato, e codificato in base64, perci\u00f2 la pagina di login dovr\u00e0 riuscire a decodificare la stringa base64, eventualmente decriptare il token mediante la chiave impostata nella servlet (l\u2019algoritmo utilizzato \u00e8 il 3-DES/ECB/NoPadding), ed infine volendo, verificare la firma del token.</p> <p>Quest\u2019ultimo passaggio in realt\u00e0 non \u00e8 strettamente necessario ai fini della sicurezza qualora la connessione ai server Cohesion sia fatta in HTTPS. Questo perch\u00e9 la servlet controlla automaticamente che il certificato SSL della pagina corrisponda effettivamente al nome DNS usato, e in caso negativo ritorna una notifica. </p> <p>Solo dopo questi passaggi si potr\u00e0 autenticare l\u2019utente ed aggiungere il token nella propria sessione.</p> <p>Nel pacchetto vengono fornite due pagine login di esempio; una sviluppata in JSP ed un'altra in PHP, insieme al certificato Cohesion necessario a verificare la firma digitale del token.</p> <p>Per effettuare il logout \u00e8 invece sufficiente creare una pagina di logout che rediriga alla servlet \u201cLogout\u201d. \u00c8 possibile anche in questo caso specificare il parametro ReturnUrl che sar\u00e0 l\u2019indirizzo a cui la servlet ridiriger\u00e0 l\u2019utente una volta effettuata la disconnessione da Cohesion. Nel pacchetto vengono fornite oltre alle pagine di login anche due semplici pagine di logout, una in JSP ed una in PHP.</p> <p>Di seguito verranno elencate le operazioni di configurazione da effettuare:</p> <ol> <li> <p>Effettuare il deploy del WAR: Nel caso di Apache Tomcat come servlet container, copiare il file CohesionServlet.war dentro la cartella webapp e lanciare Tomcat in modo da effettuare automaticamente il deploy della servlet. Nel caso Tomcat sia configurato per non effettuare il deploy automatico \u00e8 sufficiente scompattare il file .war (\u00e8 un archivio zip) nella cartella webapp/CohesionServlet.</p> </li> <li> <p>Importare i certificati CA della Regione Marche presenti nel keystore RegioneMarcheCA.keystore, nel keystore interno di java mediante il comando:</p> </li> </ol> <pre><code>keytool -importkeystore -srckeystore RegioneMarcheCA.keystore\n</code></pre> <p>La password del keystore RegioneMarcheCA.keystore \u00e8 \u201cpassword\u201d mentre la password dell\u2019 keystore java di default dovrebbe essere \u201cchangeit\u201d.</p> <p>Alternativamente a questa procedura \u00e8 possibile lanciare Tomcat o JBoss specificando il keystore da utilizzare per i certificati CA;  I parametri da aggiungere alla variabile di sistema JAVA_OPTS comunemente usata in Tomcat e JBoss sono:</p> <pre><code>-Djavax.net.ssl.trustStore=/path/RegioneMarcheCA.keystore\n-Djavax.net.ssl.trustStorePassword=password\n</code></pre> <ol> <li> <p>Copiare il certificato personale presente nel pacchetto in una cartella sicura (non accessibile via web). Nel caso il certificato abbia estensione .pfx, \u00e8 fondamentale rinominarlo in .p12. Qualora non sia stato fornito un certificato personale insieme alla servlet \u00e8 possibile utilizzare la modalit\u00e0 di recupero sicuro del token di autenticazione specificando il parametro \u201cwebSso\u201d descritto nel punto 4c. In tal caso il parametro \u201cwsSso\u201d presente nel punto 4c e tutti i parametri del punto 4a potranno essere ignorati. Questa \u00e8 la modalit\u00e0 di default con cui viene fornita la servlet.</p> </li> <li> <p>Modificare il file di configurazione nella cartella webapp/CohesionServlet/WEB-INF/web.xml nel caso di Tomcat, impostando i seguenti parametri:</p> </li> </ol> <p>a) Parametri relativi al certificato Qualora fosse stato rilasciato un certificato personale insieme alla servlet, questi parametri andranno obbligatoriamente cambiati in quanto sono specifici per il singolo certificato utente e sono presenti sia per la servlet di autenticazione che per quella di logout:</p> <ul> <li>keystorePath: Inserire il percorso del certificato personale del punto 3).</li> <li>keystoreType: Se il file \u00e8 un .p12 o un .pfx rinominato in .p12 lasciare il valore PKCS12.</li> <li>pwdKeystore: La password che protegge il certificato</li> <li>pwdCertificate: La password che protegge la chiave privata. Solitamente \u00e8 uguale a pwdKeystore</li> <li>aliasCertificate: L'alias del certificato. Per visualizzarlo utilizzare il comando:</li> </ul> <pre><code>keytool -list -keystore &lt;certificato&gt;.p12 -storetype pkcs12\n</code></pre> <p>Il comando \u00e8 presente nella cartella bin di Java e restituir\u00e0 un output simile al seguente:</p> <p><code>be7446f14507a331c1b5b8ff70a66520_d0e8d7b1-bcb5-4128-9d8e-2fc4dc332132</code>, 30-ott-2012, PrivateKeyEntry, Impronta digitale certificato (SHA1): DC:DD:60:1C:9D:43:AF:9B:F7:6E:AE:6B:5A:D5:F7:14:33:D0:0C:5C</p> <p>Il primo valore terminato dalla virgola \u00e8 l'alias da inserire.</p> <p>b) Parametri relativi al token utente restituito</p> <p>Questi parametri sono opzionali e relativi solo all'invio del token tra la servlet e la pagina di login:</p> <ul> <li>encryptionKey:Questo parametro \u00e8 opzionale. Se impostato deve avere una lunghezza fissa di 24 caratteri e permetter\u00e0 di restituire alla pagina di login il token utente crittografato usando l\u2019algoritmo 3-DES/ECB/NoPadding. Il token sar\u00e0 perci\u00f2 prima firmato, poi crittografato ed infine convertito in base64 e inviato in POST alla pagina di login. L\u2019utilizzo della cifratura del token \u00e8 necessario qualora si utilizzi una pagina di login non protetta da connessione sicura https. Qualora la connessione sia in https \u00e8 sufficiente la firma del token per garantire un livello sicurezza elevato.</li> <li>urlRichiesta: Questo valore va impostato solo nel caso si scelga di non inviare il parametro ReturnUrl durante la chiamata alla servlet di autenticazione per mezzo della pagina di login. In tal caso la servlet restituir\u00e0 il token utente in POST alla pagina specificata in urlRichiesta, altrimenti sar\u00e0 restituito alla pagina specificata in ReturnUrl.</li> <li>urlIndex: pagina iniziale a cui reindirizzare in caso di errore. Se non viene specificata viene mostrato l'errore nella pagina in cui si presenta.</li> </ul> <p>c) Parametri relativi all'IdP Cohesion Per abilitare il funzionamento in modalit\u00e0 SAML2.0 \u00e8 sufficiente cambiare i valori di urlCheck, wsSso e additionalData nel seguente modo:</p> <ul> <li>urlCheck: https://cohesion2.regione.marche.it/SPManager/WAYF.aspx</li> <li>wsSso: https://cohesion2.regione.marche.it/SPManager/wsCheckSessionSPM.asmx</li> <li>additionalData: http://yourhost/YOURSITE/Logout.aspx</li> </ul> <p>Deve contenere obbligatoriamente il percorso completo della propria pagina di logout affinch\u00e9 il logout SAML funzioni correttamente. Pu\u00f2 contenere altri due parametri opzionali: i livelli di autenticazione da mostrare (parametro AuthRestriction) e un flag per mostrare solo i meccanismi di accesso federato SPID, CIEID, CNS e l'accesso tramite dominio. I vari parametri vanno separati da punto e virgola \";\".</p> <p>Per approfondimenti in merito alla configurazione dei parametri addizionali, \u00e8 possibile far riferimento alla pagina Parametri della Richiesta di Autenticazione </p> <p>Opzionale</p> <p>Dopo l'URL di logout \u00e8 possibile inserire la stringa eidas=1. L'inserimento di questa stringa abilita la login eIDAS nel sistema di autenticazione SAML 2.0 di Cohesion. Questa opzione \u00e8 compatibile con tutte le altre fin qui indicate. </p> <p>Es. <code>AuthRestriction=2,1;http://host/YOURSITE/Logout.aspx;UType=c;eidas=1</code></p> <p>Affinch\u00e8 in modalit\u00e0 SAML2.0 funzioni il single logout \u00e8 poi necessario che la propria pagina di logout richiami la servlet di logout passando il parametro ReturnUrl valorizzato come segue:</p> <p><code>\u2026./Logout? ReturnUrl=https%3A%2F%2Fcohesion2.regione.marche.it%2FSPManager%2FLogout.aspx</code></p> <p>E' possibile forzare l'entityID utilizzato dall'utente, impostando il seguente parametro nel query string    entityID=:idp <p>Esempio (Sviluppo):</p> <pre><code>https://cohesion2sviluppo.regione.marche.it/SPManager/WAYF.aspx?entityID=cohesion.regione.marche.it:idp\n</code></pre> <p>Esempio (Produzione):</p> <pre><code>https://cohesion2.regione.marche.it/SPManager/WAYF.aspx?entityID=cohesion2.regione.marche.it:idp\n</code></pre>"},{"location":"Integrazione-Servlet-Java/#parametro-id_sito","title":"Parametro id_sito","text":"<p>In caso per l'integrazione sia necessario impostare un IDSito col valore fornito da Regione Marche in fase di abilitazione all'uso di cohesion, il valore va sostituito nella classe contenuta nel WAR Java</p> <pre><code>WEB-INF\\classes\\it\\unicam\\cs\\cohesion\\servlet\\AuthServlet.java\n</code></pre> <p>riga 34 [private String idsito = \"TEST\";]</p> <p>e nella classe</p> <pre><code>WEB-INF\\classes\\it\\unicam\\cs\\cohesion\\servlet\\LogoutServlet.java\n</code></pre> <p>riga 22 [private String idsito = \"TEST\";]</p>"},{"location":"Integrazione-Servlet-Java/#rinnovo-asserzione-saml","title":"Rinnovo asserzione SAML","text":"<p>Una volta autenticati, la sessione per il Single Sign On sar\u00e0 valida per 60 minuti. Nella modalit\u00e0 SAML questo tempo sar\u00e0 anche specificato nella risposta SAML ritornata dall\u2019IdP. Entro tale tempo sar\u00e0 possibile accedere a qualunque sito protetto da Cohesion senza che appaia la maschera di autenticazione. Il Service Provider in tal caso otterr\u00e0 un nuovo token (contenente anche una nuova asserzione SAML in caso di modalit\u00e0 SAML) ed un rinnovamento del cookie di sessione per altri 60 minuti.</p> <p>Qualora si volesse rinnovare la sessione dal proprio SP sar\u00e0 perci\u00f2 necessario cancellare il cookie di sessione del proprio sito entro i 60 minuti (es. a 50 minuti) e redirigere l\u2019utente ad una propria pagina privata che richiede l\u2019autenticazione per l\u2019accesso. A questo punto il SP rigirer\u00e0 l\u2019utente all\u2019IdP Cohesion che, vedendo ancora valida la sessione, aggiorner\u00e0 il cookie di sessione di altri 60 minuti e ritorner\u00e0 un nuovo token o una nuova asserzione SAML valida altri 60 minuti senza mostrare l\u2019interfaccia di autenticazione.</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/","title":"Parametri della Richiesta di Autenticazione","text":"<p>In questa sezione definiamo in dettaglio i parametri di autenticazione presenti nel tag <code>stilesheet</code> della Richiesta di Autenticazione effettuata da Cohesion.</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-16\"?&gt;\n&lt;dsAuth xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\nxmlns=\"http://tempuri.org/Auth.xsd\"\n&lt;auth&gt;\n&lt;user /&gt;\n&lt;id_sa /&gt;\n&lt;id_sito&gt;SITE_ID&lt;/id_sito&gt;\n&lt;esito_auth_sa /&gt;\n&lt;id_sessione_sa /&gt;\n&lt;id_sessione_aspnet_sa /&gt;\n&lt;url_validate&gt;\nhttps://cohesion2.regione.marche.it/TestCohesion/ValidateFE.aspx?ReturnUrl=%2ftestcohesion%2fprivato%2fpagina_protetta.aspx&lt;/url_validate&gt;\n&lt;url_richiesta&gt;\nhttps://cohesion2.regione.marche.it:443/testcohesion/privato/pagina_protetta.aspx&lt;/url_richiesta&gt;\n&lt;esito_auth_sso /&gt;\n&lt;id_sessione_sso /&gt;\n&lt;id_sessione_aspnet_sso /&gt;\n&lt;stilesheet&gt;AuthRestriction=3,2,1,0;\nhttps://cohesion2.regione.marche.it/testcohesion/Index.aspx;UType=d;purpose=PG|PF|LP;aggregato=1;eidas=3;SpidMode=OIDC;CieMode=OIDC;IPA=c_000&lt;/stilesheet&gt;\n&lt;/auth&gt;\n&lt;/dsAuth&gt;\n</code></pre>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#authrestriction","title":"<code>AuthRestriction</code>","text":"<p>Il parametro <code>AuthRestriction</code> stabilisce il livello di autenticazione minimo richiesto associandolo a un valore numerico (0,1,2,3). Nello specifico:</p> <p>0= Accesso solo con password - SPID Livello 1</p> <p>1= Accesso con password e PIN o token OTP - SPID Livello 2</p> <p>2= Accesso con smartcard - SPID Livello 3</p> <p>3= Accesso con Dominio Active Directory REGIONEMARCHE</p> <p>Ad esempio, impostando il parametro come <code>AuthRestriction=3,2,1</code> stabiliamo che l'accesso sar\u00e0 consentito ad utenze che dispongono di credenziali SPID di Livello 2 e 3, nonch\u00e9 tramite Dominio, ma non sar\u00e0 possibile utilizzare credenziali SPID di primo livello.</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#url-di-reindirizzamento","title":"URL di reindirizzamento","text":"<p>L'URL al quale l'utente sar\u00e0 reindirizzato dopo aver effettuato l'autenticazione.</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#utype","title":"<code>UType</code>","text":"<p>Specifica la tipologia di utente che accede tramite Cohesion. Si distinguono 3 differenti tipologie:</p> <p><code>UType=c</code> = Accesso per soli cittadini, l'autenticazione tramite credenziali Cohesion \u00e8 disabilitata</p> <p><code>UType=d</code> = Accesso per soli Dipendenti della PA, viene abilitata l'autenticazione tramite credenziali Cohesion</p> <p><code>UType=cd</code> = Accesso per Dipendenti delle PA e Cittadini, l'autenticazione tramite credenziali Cohesion \u00e8 abilitata (opzione di default)</p> <p>Ad esempio, impostando il parametro come segue <code>UType=c</code> stabiliamo che l'unica tipologia di utenza accettabile \u00e8 il cittadino, disabilitando l'accesso tramite credenziali Cohesion</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#purpose","title":"<code>purpose</code>","text":"<p>Definisce il livello di sicurezza SPID in base alla tipologia (o scopo) dell'utente. Si distinguono in:</p> <p>PF = SPID personale per Persona Fisica, costituisce l'identit\u00e0 di un cittadino che accede ai servizi della PA</p> <p>LP = SPID del Libero Professionista, racchiude i dati i dati della persona fisica ed eventuali attributi che caratterizzano la sua professione.</p> <p>PG = SPID Giuridico, rilasciata ad una persona fisica a cui vengono associati anche i dati della persona giuridica per cui opera.</p> <p>Ad esempio, impostando il parametro come <code>purpose=PG</code> Cohesion consentir\u00e0 l'accesso solamente alle persone dotate di SPID Giuridico.</p> <p>Per la lista completa dei gestori di Identit\u00e0 Digitali che supportano le tipologie PG e LP, si prega di consultare il seguente link: https://www.agid.gov.it/it/piattaforme/spid</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#aggregato","title":"<code>aggregato</code>","text":"<p>Se l'ente \u00e8 federato in modalit\u00e0 aggregata, sar\u00e0 necessario inserire il parametro <code>aggregato=1</code></p> <p>Se non specificato, verr\u00e0 utilizzata la modalit\u00e0 di default diretta</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#eidas","title":"<code>eidas</code>","text":"<p>Abilita il login tramite il nodo italiano eIDAS specificando se, a valle dell'autenticazione, \u00e8 necessaria la verifica del Codice Fiscale:</p> <p><code>eidas=1</code> = Autenticazione eidas abilitata, nessuna verifica del Codice Fiscale.</p> <p><code>eidas=2</code> = Verifica semplice del Codice Fiscale.</p> <p><code>eidas=3</code> = Verifica del Codice Fiscale con supporto fisico.</p> <p>Ad esempio, impostando il parametro come <code>eidas=3</code> sar\u00e0 necessaria la verifica del Codice Fiscale tramite supporto, escludendo i livelli di autenticazione pi\u00f9 bassi.</p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#spidmode","title":"<code>SpidMode</code>","text":"<p>Definisce il protocollo di autenticazione che CohesionID deve utilizzare per comunicare con la piattaforma nazionale SPID. </p> <p>Se non specificato, verr\u00e0 utilizzato il protocollo di default SAML. Impostando il parametro come <code>SpidMode=OIDC</code> verr\u00e0 utilizzato il nuovo protocollo OpenID Connect </p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#ciemode","title":"<code>CieMode</code>","text":"<p>Definisce il protocollo di autenticazione che CohesionID deve utilizzare per comunicare con la piattaforma nazionale CIE. </p> <p>Se non specificato, verr\u00e0 utilizzato il protocollo di default SAML mentre, impostando il parametro come <code>CieMode=OIDC</code>, verr\u00e0 utilizzato il nuovo protocollo OpenID Connect </p>"},{"location":"Parametri-della-Richiesta-di-Autenticazione/#ipa","title":"<code>IPA</code>","text":"<p>L'IPA \u00e8 l'Indice delle Pubbliche Amministrazioni, univoco ad ogni ente della Pubblica Amministrazione. </p> <p>Specificando questo parametro, CohesionID effettuer\u00e0 la richiesta di autenticazione verso le piattaforme nazionali ed europee per conto dell'ente aggregato specificato.</p>"},{"location":"Per-PA-e-Imprese/","title":"Per PA e Imprese","text":"<p>Il framework di autenticazione Cohesion ID pu\u00f2 essere integrato esclusivamente nei siti della Pubblica Amministrazione. </p> <p>Se il sito \u00e8 pubblicato da o per conto della Regione Marche o dipendi da un Ente che ha sottoscritto la convenzione per l\u2019utilizzo dell\u2019infrastruttura di autenticazione e accesso, consulta la nostra guida Come Integrare Cohesion</p>"},{"location":"Pubbliche-Amministrazioni-e-Imprese/","title":"Come integro CohesionID?","text":""},{"location":"Pubbliche-Amministrazioni-e-Imprese/#richiesta-di-integrazione","title":"Richiesta di Integrazione","text":"<p>Il primo step del processo di Integrazione del Sistema Cohesion nel proprio applicativo \u00e8 la Richiesta di Integrazione.</p> <p>Nel caso in cui il sistema informativo in questione sia pubblicato da o per conto di Regione Marche \u00e8 possibile compilare direttamente la Richiesta di Integrazione al link: Richiesta di Integrazione.  Ricordiamo che Cohesion \u00e8 integrabile esclusivamente nei siti della pubblica amministrazione. </p> <p>Nel caso in cui l\u2019Ente responsabile non sia Regione Marche \u00e8 necessario assicurarsi che questi abbia sottoscritto la convenzione per l\u2019utilizzo dell\u2019infrastruttura di autenticazione e accesso della Regione Marche quale Soggetto Aggregatore SPID: https://procedimenti.regione.marche.it/AreaPA/TipologieProcedimento/DettagliTer/13915</p>"},{"location":"Pubbliche-Amministrazioni-e-Imprese/#id-sito","title":"ID Sito","text":"<p>Effettuata la richiesta, i nostri tecnici processeranno i dati inseriti ed invieranno una mail al tecnico indicato con l'ID Sito univoco per la vostra applicazione.</p>"},{"location":"Pubbliche-Amministrazioni-e-Imprese/#integrazione","title":"Integrazione","text":"<p>Completata la richiesta di Integrazione e ottenuto l'ID Sito, sar\u00e0 possibile procedere all'effettiva integrazione nel proprio applicativo. Per supporto nell'integrazione, consulta la documentazione relativa al flusso di autenticazione e i parametri della richiesta di autenticazione. Nel caso si voglia utilizzare una delle integrazioni gi\u00e0 disponibili, consultare la Documentazione Tecnica</p>"},{"location":"Rinnovo-del-Token/","title":"Come rinnovare il Token","text":"<p>Il Token di Cohesion ha validit\u00e0 di 60 minuti. Se si vuole rinnovare il Token \u00e8 necessario che l'utente transiti nuovamente per la pagina di LogIn di Cohesion.  Questa operazione va fatta prima della scadenza del Token.</p> <p>Esempi:</p> <p>1) Integrazione C#:</p> <p>Per rinnovare il token \u00e8 sufficiente reindirizzare l'utente alla propria pagina di login, in modo da eseguire nuovamente il codice</p> <pre><code>CohesionSSO cohesionSSO = new CohesionSSO(Request, Response, Session);\n\ncohesionSSO.ValidateFE();\n</code></pre> <p>2) Integrazione Servlet Java:</p> <p>Per rinnovare il token \u00e8 sufficiente reindirizzare l'utente alla Servlet Java, di norma richiamata dalla pagina di login della applicazione.</p> <p>In entrambi i casi l'utente viene reindirizzato a Cohesion, il sistema verifica che ha gi\u00e0 una sessione valida, genera un nuovo Token valido 60 minuti e reindirizza l'utente all'applicazione.</p> <p>Se si integra con modalit\u00e0 SPManager, per evitare che - al nuovo passaggio su Cohesion - venga riproposta all'utente la schermata di scelta del provider, impostare il parametro entityID passandolo alla pagina WAYF SAML.</p> <p>Ad esempio:</p> <ul> <li>Cohesion Sviluppo</li> </ul> <pre><code>https://cohesion2sviluppo.regione.marche.it/SPManager/WAYF.aspx?entityID=cohesion.regione.marche.it:idp\n</code></pre> <ul> <li>Cohesion Produzione</li> </ul> <pre><code>https://cohesion2.regione.marche.it/SPManager/WAYF.aspx?entityID=cohesion2.regione.marche.it:idp\n</code></pre> <p>ovvero passando il parametro entityID valorizzato con l'id dell'entit\u00e0 SAML a cui si vuole redirigere automaticamente (che nel caso di cohesion \u00e8 cohesion.regione.marche.it:idp).</p>"},{"location":"Tipologie-e-livelli-di-accesso-disponibili-in-CohesionID/","title":"Tipologie e livelli di accesso disponibili in CohesionID","text":"SSO Livello eIDAS tipo_autenticazione issuer Assertiion/Issuer AuthnContextClassRef SPID L1 LoA2 PW provider, es: https://posteid.poste.it/ Uguale al precedente https://www.spid.gov.it/SpidL1 SPID L2 LoA3 PIN provider, es: https://posteid.poste.it/ Uguale al precedente https://www.spid.gov.it/SpidL2 CIE L1 LoA2 PW https://idserver.servizicie.interno.gov.it/idp/profile/SAML2/POST/SSO Uguale al precedente https://www.spid.gov.it/SpidL1 CIE L2 LoA3 PIN https://idserver.servizicie.interno.gov.it/idp/profile/SAML2/POST/SSO Uguale al precedente https://www.spid.gov.it/SpidL2 CIE L3 LoA4 CF https://idserver.servizicie.interno.gov.it/idp/profile/SAML2/POST/SSO Uguale al precedente https://www.spid.gov.it/SpidL3 cf+psw L1 LoA2 PW cohesion2.regione.marche.it:idp Uguale al precedente urn:oasis:names:tc:SAML:2.0:ac:classes:Password cf+psw+pin L2 LoA3 PIN cohesion2.regione.marche.it:idp Uguale al precedente urn:oasis:names:tc:SAML:2.0:ac:classes:Smartcard cf+psw+otp L2 LoA3 PIN cohesion2.regione.marche.it:idp Uguale al precedente urn:oasis:names:tc:SAML:2.0:ac:classes:Smartcard DOMINIO L1 LoA2 DRM cohesion2.regione.marche.it:idp Uguale al precedente urn:oasis:names:tc:SAML:2.0:ac:classes:Kerberos CNS L2 LoA3 CF cohesion2.regione.marche.it:sp Uguale al precedente urn:oasis:names:tc:SAML:2.0:ac:classes:SmartcardPKI eIDAS L1/2/3 LoA2/3/4 CF https://sp-proxy.pre.eid.gov.it/spproxy/idpit Uguale al precedente https://www.spid.gov.it/SpidL1-2-3"}]}