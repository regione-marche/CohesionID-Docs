<!-- Annuncio -->

<!doctype html>
<html lang="it" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cohesion.regione.marche.it/CohesionDocs/Integrazione-Servlet-Java/">
      
      
        <link rel="prev" href="../Integrazione-C-Sharp-Core/">
      
      
        <link rel="next" href="../Rinnovo-del-Token/">
      
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Integrazione Java - CohesionID-Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrazione-mediante-servlet-java" class="md-skip">
          Vai al contenuto
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Non mostrare piÃ¹">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
              </button>
            
            
Hai bisogno di assistenza con Cohesion? <a href="mailto:integrazioneCohesion@regione.marche-it?subject=Assistenza cohesion">Contattaci</a>

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Intestazione">
    <a href="https://www.regione.marche.it/" title="CohesionID-Docs" class="md-header__button md-logo" aria-label="CohesionID-Docs" data-md-component="logo">
      
  <img src="../images/regione-marche-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CohesionID-Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Integrazione Java
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Cerca" placeholder="Cerca" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Cerca">
        
        <button type="reset" class="md-search__icon md-icon" title="Cancella" aria-label="Cancella" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inizializza la ricerca
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Pubbliche-Amministrazioni-e-Imprese/" class="md-tabs__link">
          
  
  
  Integrare Cohesion

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../FAQ/" class="md-tabs__link">
        
  
  
    
  
  FAQ

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigazione" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://www.regione.marche.it/" title="CohesionID-Docs" class="md-nav__button md-logo" aria-label="CohesionID-Docs" data-md-component="logo">
      
  <img src="../images/regione-marche-logo.png" alt="logo">

    </a>
    CohesionID-Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Home
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cohesion id
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Integrare Cohesion
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Integrare Cohesion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Pubbliche-Amministrazioni-e-Imprese/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrare Cohesion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Flusso-di-Autenticazione/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flusso di autenticazione
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Parametri-della-Richiesta-di-Autenticazione/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parametri della richiesta di autenticazione
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tipologie-e-livelli-di-accesso-disponibili-in-CohesionID/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tipologie e livelli di accesso disponibili
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" checked>
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentazione tecnica
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Documentazione tecnica
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/regione-marche/Cohesion2NETCore8Library" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrazione .NET Core 8
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Integrazione-Classe-C-Sharp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrazione C#
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Integrazione-C-Sharp-Core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrazione C# Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Integrazione Java
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Integrazione Java
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisiti" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisiti:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisiti:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parametro-id_sito" class="md-nav__link">
    <span class="md-ellipsis">
      Parametro id_sito
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rinnovo-asserzione-saml" class="md-nav__link">
    <span class="md-ellipsis">
      Rinnovo asserzione SAML
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/regione-marche/Cohesion2PHPLibrary" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrazione PHP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/regione-marche/Cohesion2PythonIntegrationTest" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrazione Phyton
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Rinnovo-del-Token/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rinnovo del Token
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://colab.research.google.com/gist/xavbeta/f710b69eba7843c006ff11e561e1c2c1/configurazione-integrazione-cohesion.ipynb" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuratore integrazioni
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Indice">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Indice
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisiti" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisiti:
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisiti:">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parametro-id_sito" class="md-nav__link">
    <span class="md-ellipsis">
      Parametro id_sito
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rinnovo-asserzione-saml" class="md-nav__link">
    <span class="md-ellipsis">
      Rinnovo asserzione SAML
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="integrazione-mediante-servlet-java"><strong>Integrazione mediante servlet Java</strong><a class="headerlink" href="#integrazione-mediante-servlet-java" title="Permanent link">&para;</a></h1>
<p>Con il presente si vuole fornire una panoramica completa delle modalitÃ  di integrazione e delle configurazioni di utilizzo del Service Provider fornito con Cohesion in applicativi web che richiedono autenticazione e profilazione utente.
VerrÃ  in dettaglio descritta la procedura di installazione in ambiente Java Servlet e la configurazione per lâutilizzo classico ed il funzionamento in modalitÃ  federata SAML2.0.</p>
<blockquote>
<p><strong><a href="https://github.com/regione-marche/Cohesion2Servlet/blob/main/integrazione%20mediante%20Servlet.zip?raw=true">Scarica la Servlet Java ed il manuale</a></strong></p>
<p><strong><a href="https://github.com/regione-marche/Cohesion2Servlet/blob/main/CohesionServlet-3.0.zip?raw=true">Scarica la versione per java8 e successive</a></strong></p>
<p><strong><a href="https://github.com/regione-marche/Cohesion2Servlet/blob/main/Keystore_java.zip?raw=true">Scarica il keystore valido a partire dal 16/02/2022</a></strong></p>
</blockquote>
<hr />
<h2 id="prerequisiti"><strong>Prerequisiti</strong>:<a class="headerlink" href="#prerequisiti" title="Permanent link">&para;</a></h2>
<ul>
<li>Apache Tomcat v6+, JBoss, Glassfish</li>
<li>Java v 1.6+</li>
</ul>
<p>La servlet per lâintegrazione di Cohesion Ã¨ stata riscritta in modo da essere compatibile anche con qualunque servlet container e non utilizzare librerie esterne e componenti aggiuntivi che ne potrebbero limitare la compatibilitÃ .</p>
<p>Inoltre Ã¨ stato aggiunto il supporto alla funzionalitÃ  di logout, prima assente. Abbiamo quindi la servlet âAuthenticationâ che fornisce Single Sign On e la servlet âLogoutâ che effettua il logout da Cohesion. Usando questo pacchetto, Cohesion potrÃ  essere integrato in ogni tipologia di sito a prescindere dal linguaggio di progettazione (volendo anche in un sito .NET su IIS).</p>
<p>Una volta configurata la servlet e lanciato lâambiente Tomcat infatti, sarÃ  sufficiente creare nel proprio sito una pagina di login che rediriga alla pagina servlet âAuthenticationâ specificando il parametro ReturnUrl, che dovrÃ  contenere lâurl della pagina a cui la servlet ritornerÃ  il token utente.</p>
<p>Tale pagina puÃ² essere la stessa pagina di login, lâimportante Ã¨ che sia in grado di processare il token utente ricevuto via POST. Il token Ã¨ firmato, eventualmente crittografato, e codificato in base64, perciÃ² la pagina di login dovrÃ  riuscire a decodificare la stringa base64, eventualmente decriptare il token mediante la chiave impostata nella servlet (lâalgoritmo utilizzato Ã¨ il 3-DES/ECB/NoPadding), ed infine volendo, verificare la firma del token.</p>
<p>Questâultimo passaggio in realtÃ  non Ã¨ strettamente necessario ai fini della sicurezza qualora la connessione ai server Cohesion sia fatta in HTTPS. Questo perchÃ© la servlet controlla automaticamente che il certificato SSL della pagina corrisponda effettivamente al nome DNS usato, e in caso negativo ritorna una notifica. </p>
<p>Solo dopo questi passaggi si potrÃ  autenticare lâutente ed aggiungere il token nella propria sessione.</p>
<p>Nel pacchetto vengono fornite due pagine login di esempio; una sviluppata in JSP ed un'altra in PHP, insieme al certificato Cohesion necessario a verificare la firma digitale del token.</p>
<p>Per effettuare il logout Ã¨ invece sufficiente creare una pagina di logout che rediriga alla servlet âLogoutâ. Ã possibile anche in questo caso specificare il parametro ReturnUrl che sarÃ  lâindirizzo a cui la servlet ridirigerÃ  lâutente una volta effettuata la disconnessione da Cohesion. Nel pacchetto vengono fornite oltre alle pagine di login anche due semplici pagine di logout, una in JSP ed una in PHP.</p>
<p><em>Di seguito verranno elencate le operazioni di configurazione da effettuare</em>:</p>
<ol>
<li>
<p>Effettuare il deploy del WAR: Nel caso di Apache Tomcat come servlet container, copiare il file CohesionServlet.war dentro la cartella webapp e lanciare Tomcat in modo da effettuare automaticamente il deploy della servlet. Nel caso Tomcat sia configurato per non effettuare il deploy automatico Ã¨ sufficiente scompattare il file .war (Ã¨ un archivio zip) nella cartella webapp/CohesionServlet.</p>
</li>
<li>
<p>Importare i certificati CA della Regione Marche presenti nel keystore RegioneMarcheCA.keystore, nel keystore interno di java mediante il comando:</p>
</li>
</ol>
<div class="codehilite"><pre><span></span><code><span class="n">keytool</span><span class="w"> </span><span class="o">-</span><span class="n">importkeystore</span><span class="w"> </span><span class="o">-</span><span class="n">srckeystore</span><span class="w"> </span><span class="n">RegioneMarcheCA</span><span class="p">.</span><span class="na">keystore</span>
</code></pre></div>

<p>La password del keystore RegioneMarcheCA.keystore Ã¨ âpasswordâ mentre la password dellâ keystore java di default dovrebbe essere âchangeitâ.</p>
<p>Alternativamente a questa procedura Ã¨ possibile lanciare Tomcat o JBoss specificando il keystore da utilizzare per i certificati CA; 
I parametri da aggiungere alla variabile di sistema JAVA_OPTS comunemente usata in Tomcat e JBoss sono:</p>
<div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="n">Djavax</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">ssl</span><span class="p">.</span><span class="na">trustStore</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">RegioneMarcheCA</span><span class="p">.</span><span class="na">keystore</span>
<span class="o">-</span><span class="n">Djavax</span><span class="p">.</span><span class="na">net</span><span class="p">.</span><span class="na">ssl</span><span class="p">.</span><span class="na">trustStorePassword</span><span class="o">=</span><span class="n">password</span>
</code></pre></div>

<ol>
<li>
<p>Copiare il certificato personale presente nel pacchetto in una cartella sicura (non accessibile via web). Nel caso il certificato abbia estensione .pfx, Ã¨ fondamentale rinominarlo in .p12. Qualora non sia stato fornito un certificato personale insieme alla servlet Ã¨ possibile utilizzare la modalitÃ  di recupero sicuro del token di autenticazione specificando il parametro <strong>âwebSsoâ</strong> descritto nel punto 4c. In tal caso il parametro <strong>âwsSsoâ</strong> presente nel punto 4c e tutti i parametri del punto 4a potranno essere ignorati. Questa Ã¨ la modalitÃ  di default con cui viene fornita la servlet.</p>
</li>
<li>
<p>Modificare il file di configurazione nella cartella webapp/CohesionServlet/WEB-INF/web.xml nel caso di Tomcat, impostando i seguenti parametri:</p>
</li>
</ol>
<p><strong>a) Parametri relativi al certificato</strong>
Qualora fosse stato rilasciato un certificato personale insieme alla servlet, questi parametri andranno obbligatoriamente cambiati in quanto sono specifici per il singolo certificato utente e sono presenti sia per la servlet di autenticazione che per quella di logout:</p>
<ul>
<li><strong>keystorePath</strong>: Inserire il percorso del certificato personale del punto 3).</li>
<li><strong>keystoreType</strong>: Se il file Ã¨ un .p12 o un .pfx rinominato in .p12 lasciare il valore PKCS12.</li>
<li><strong>pwdKeystore</strong>: La password che protegge il certificato</li>
<li><strong>pwdCertificate</strong>: La password che protegge la chiave privata. Solitamente Ã¨ uguale a pwdKeystore</li>
<li><strong>aliasCertificate</strong>: L'alias del certificato. Per visualizzarlo utilizzare il comando:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">keytool</span><span class="w"> </span><span class="o">-</span><span class="n">list</span><span class="w"> </span><span class="o">-</span><span class="n">keystore</span><span class="w"> </span><span class="o">&lt;</span><span class="n">certificato</span><span class="o">&gt;</span><span class="p">.</span><span class="na">p12</span><span class="w"> </span><span class="o">-</span><span class="n">storetype</span><span class="w"> </span><span class="n">pkcs12</span>
</code></pre></div>

<p>Il comando Ã¨ presente nella cartella bin di Java e restituirÃ  un output simile al seguente:</p>
<p><code>be7446f14507a331c1b5b8ff70a66520_d0e8d7b1-bcb5-4128-9d8e-2fc4dc332132</code>, 30-ott-2012, PrivateKeyEntry, Impronta digitale certificato (SHA1): DC:DD:60:1C:9D:43:AF:9B:F7:6E:AE:6B:5A:D5:F7:14:33:D0:0C:5C</p>
<p>Il primo valore terminato dalla virgola Ã¨ l'alias da inserire.</p>
<p><strong>b) Parametri relativi al token utente restituito</strong></p>
<p>Questi parametri sono opzionali e relativi solo all'invio del token tra la servlet e la pagina di login:</p>
<ul>
<li><strong>encryptionKey</strong>:Questo parametro Ã¨ opzionale. Se impostato deve avere una lunghezza fissa di 24 caratteri e permetterÃ  di restituire alla pagina di login il token utente crittografato usando lâalgoritmo 3-DES/ECB/NoPadding. Il token sarÃ  perciÃ² prima firmato, poi crittografato ed infine convertito in base64 e inviato in POST alla pagina di login. Lâutilizzo della cifratura del token Ã¨ necessario qualora si utilizzi una pagina di login non protetta da connessione sicura https. Qualora la connessione sia in https Ã¨ sufficiente la firma del token per garantire un livello sicurezza elevato.</li>
<li><strong>urlRichiesta</strong>: Questo valore va impostato solo nel caso si scelga di non inviare il parametro ReturnUrl durante la chiamata alla servlet di autenticazione per mezzo della pagina di login. In tal caso la servlet restituirÃ  il token utente in <strong>POST</strong> alla pagina specificata in <strong>urlRichiesta</strong>, altrimenti sarÃ  restituito alla pagina specificata in <strong>ReturnUrl</strong>.</li>
<li><strong>urlIndex</strong>: pagina iniziale a cui reindirizzare in caso di errore. Se non viene specificata viene mostrato l'errore nella pagina in cui si presenta.</li>
</ul>
<p><strong>c) Parametri relativi all'IdP Cohesion</strong>
Per abilitare il funzionamento in modalitÃ  SAML2.0 Ã¨ sufficiente cambiare i valori di <strong>urlCheck</strong>, <strong>wsSso</strong> e <strong>additionalData</strong> nel seguente modo:</p>
<ul>
<li><strong>urlCheck</strong>: https://cohesion2.regione.marche.it/SPManager/WAYF.aspx</li>
<li><strong>wsSso</strong>: https://cohesion2.regione.marche.it/SPManager/wsCheckSessionSPM.asmx</li>
<li><strong>additionalData</strong>: http://yourhost/YOURSITE/Logout.aspx</li>
</ul>
<p>Deve contenere obbligatoriamente il percorso completo della propria pagina di logout affinchÃ© il logout SAML funzioni correttamente. PuÃ² contenere altri due parametri opzionali: i livelli di autenticazione da mostrare (parametro AuthRestriction) e un flag per mostrare solo i meccanismi di accesso federato SPID, CIEID, CNS e l'accesso tramite dominio. I vari parametri vanno separati da punto e virgola ";".</p>
<p>Per approfondimenti in merito alla configurazione dei parametri addizionali, Ã¨ possibile far riferimento alla pagina <a href="/CohesionID-Docs/Parametri-della-Richiesta-di-Autenticazione">Parametri della Richiesta di Autenticazione</a> </p>
<blockquote>
<p>Opzionale</p>
</blockquote>
<p>Dopo l'URL di logout Ã¨ possibile inserire la stringa eidas=1. L'inserimento di questa stringa abilita la login eIDAS nel sistema di autenticazione SAML 2.0 di Cohesion. Questa opzione Ã¨ compatibile con tutte le altre fin qui indicate. </p>
<p>Es.
<code>AuthRestriction=2,1;http://host/YOURSITE/Logout.aspx;UType=c;eidas=1</code></p>
<p>AffinchÃ¨ in modalitÃ  SAML2.0 funzioni il single logout Ã¨ poi necessario che la propria pagina di logout richiami la servlet di logout passando il parametro ReturnUrl valorizzato come segue:</p>
<p><code>â¦./Logout?
ReturnUrl=https%3A%2F%2Fcohesion2.regione.marche.it%2FSPManager%2FLogout.aspx</code></p>
<p>E' possibile forzare l'entityID utilizzato dall'utente, impostando il seguente parametro nel query string    <strong>entityID=<nome idp>:idp</strong></p>
<p>Esempio (Sviluppo):</p>
<div class="codehilite"><pre><span></span><code><span class="nl">https:</span><span class="c1">//cohesion2sviluppo.regione.marche.it/SPManager/WAYF.aspx?entityID=cohesion.regione.marche.it:idp</span>
</code></pre></div>

<p>Esempio (Produzione):</p>
<div class="codehilite"><pre><span></span><code><span class="nl">https:</span><span class="c1">//cohesion2.regione.marche.it/SPManager/WAYF.aspx?entityID=cohesion2.regione.marche.it:idp</span>
</code></pre></div>

<h3 id="parametro-id_sito"><strong>Parametro id_sito</strong><a class="headerlink" href="#parametro-id_sito" title="Permanent link">&para;</a></h3>
<p>In caso per l'integrazione sia necessario impostare un IDSito col valore fornito da Regione Marche in fase di abilitazione all'uso di cohesion, il valore va sostituito nella classe contenuta nel WAR Java</p>
<div class="codehilite"><pre><span></span><code><span class="n">WEB</span><span class="o">-</span><span class="n">INF</span><span class="err">\</span><span class="n">classes</span><span class="err">\</span><span class="n">it</span><span class="err">\</span><span class="n">unicam</span><span class="err">\</span><span class="n">cs</span><span class="err">\</span><span class="n">cohesion</span><span class="err">\</span><span class="n">servlet</span><span class="err">\</span><span class="n">AuthServlet</span><span class="p">.</span><span class="na">java</span>
</code></pre></div>

<p>riga 34 [private String idsito = "TEST";]</p>
<p>e nella classe</p>
<div class="codehilite"><pre><span></span><code><span class="n">WEB</span><span class="o">-</span><span class="n">INF</span><span class="err">\</span><span class="n">classes</span><span class="err">\</span><span class="n">it</span><span class="err">\</span><span class="n">unicam</span><span class="err">\</span><span class="n">cs</span><span class="err">\</span><span class="n">cohesion</span><span class="err">\</span><span class="n">servlet</span><span class="err">\</span><span class="n">LogoutServlet</span><span class="p">.</span><span class="na">java</span>
</code></pre></div>

<p>riga 22 [private String idsito = "TEST";]</p>
<h3 id="rinnovo-asserzione-saml"><strong>Rinnovo asserzione SAML</strong><a class="headerlink" href="#rinnovo-asserzione-saml" title="Permanent link">&para;</a></h3>
<p>Una volta autenticati, la sessione per il Single Sign On sarÃ  valida per 60 minuti. Nella modalitÃ  SAML questo tempo sarÃ  anche specificato nella risposta SAML ritornata dallâIdP. Entro tale tempo sarÃ  possibile accedere a qualunque sito protetto da Cohesion senza che appaia la maschera di autenticazione. Il Service Provider in tal caso otterrÃ  un nuovo token (contenente anche una nuova asserzione SAML in caso di modalitÃ  SAML) ed un rinnovamento del cookie di sessione per altri 60 minuti.</p>
<p>Qualora si volesse rinnovare la sessione dal proprio SP sarÃ  perciÃ² necessario cancellare il cookie di sessione del proprio sito entro i 60 minuti (es. a 50 minuti) e redirigere lâutente ad una propria pagina privata che richiede lâautenticazione per lâaccesso. A questo punto il SP rigirerÃ  lâutente allâIdP Cohesion che, vedendo ancora valida la sessione, aggiornerÃ  il cookie di sessione di altri 60 minuti e ritornerÃ  un nuovo token o una nuova asserzione SAML valida altri 60 minuti senza mostrare lâinterfaccia di autenticazione.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Piede" >
        
          
          <a href="../Integrazione-C-Sharp-Core/" class="md-footer__link md-footer__link--prev" aria-label="Precedente: Integrazione C# Core">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Precedente
              </span>
              <div class="md-ellipsis">
                Integrazione C# Core
              </div>
            </div>
          </a>
        
        
          
          <a href="../Rinnovo-del-Token/" class="md-footer__link md-footer__link--next" aria-label="Successivo: Rinnovo del Token">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Successivo
              </span>
              <div class="md-ellipsis">
                Rinnovo del Token
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["announce.dismiss", "navigation.instant", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.path", "navigation.footer"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copiato", "clipboard.copy": "Copia", "search.result.more.one": "1 altro in questa pagina", "search.result.more.other": "# altri in questa pagina", "search.result.none": "Nessun documento trovato", "search.result.one": "1 documento trovato", "search.result.other": "# documenti trovati", "search.result.placeholder": "Scrivi per iniziare a cercare", "search.result.term.missing": "Non presente", "select.version": "Seleziona la versione"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>